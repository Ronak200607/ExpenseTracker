<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ExpenseTracker Pro + Splitwise</title>
<style>
    :root {
        --bg-primary: #f8f9fa;
        --bg-secondary: #ffffff;
        --bg-gradient: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        --text-color: #333;
        --text-secondary: #6c757d;
        --border-color: #e9ecef;
        --shadow-color: rgba(0,0,0,0.1);
        --input-focus: rgba(102,126,234,0.1);
        --split-tag-bg: #e9ecef;
        --recurring-color: #845ef7;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        background: var(--bg-primary); 
        min-height:100vh; 
        color: var(--text-color);
        scroll-behavior: smooth;
    }
    .container { max-width:1200px; margin:0 auto; padding:20px; }
    .header { text-align:center; margin-bottom:30px; color:var(--text-color); position:relative; }
    .header h1 { font-size:2.5rem; margin-bottom:10px; text-shadow:2px 2px 4px var(--shadow-color); color: var(--text-color); }

    /* Scroll reveal base state */
    .scroll-reveal {
        opacity: 0;
        transform: translateY(40px);
        transition: opacity 0.6s ease, transform 0.6s ease;
        will-change: opacity, transform;
    }
    /* Visible when in viewport */
    .scroll-reveal.visible {
        opacity: 1;
        transform: none;
    }

    .dashboard { display:grid; grid-template-columns:repeat(auto-fit, minmax(350px,1fr)); gap:20px; margin-bottom:30px; }
    .card { 
        background:var(--bg-secondary); border-radius:15px; padding:25px; box-shadow:0 10px 30px var(--shadow-color); 
        transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s; 
    }
    .card:hover { transform:translateY(-5px); box-shadow:0 15px 40px var(--shadow-color); }
    .summary-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; margin-bottom:30px; }
    .summary-card { color:white; padding:20px; border-radius:12px; text-align:center; box-shadow:0 8px 25px var(--shadow-color); }
    .summary-card h3 { font-size:0.9rem; margin-bottom:8px; opacity:0.9; }
    .summary-card .amount { font-size:1.8rem; font-weight:bold; }
    .summary-card.income { background: linear-gradient(135deg,#51cf66,#40c057); }
    .summary-card.balance { background: linear-gradient(135deg,#339af0,#228be6); }
    .summary-card.savings { background: linear-gradient(135deg,#845ef7,#7048e8); }
    .summary-card:not(.income):not(.balance):not(.savings) { background: linear-gradient(135deg,#ff6b6b,#ee5a52); }
    .form-group { margin-bottom:20px; }
    .form-group label { display:block; margin-bottom:8px; font-weight:600; color:var(--text-color); }
    .form-group input, .form-group select { 
        width:100%; padding:12px; border:2px solid var(--border-color); border-radius:8px; font-size:1rem; transition:border-color 0.3s ease, background 0.3s;
        background: var(--bg-primary); 
        color: var(--text-color);
    }
    .form-group input:focus, .form-group select:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 3px var(--input-focus); }
    .btn { background:var(--bg-gradient); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:600; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .btn:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 8px 20px rgba(102,126,234,0.3); }
    .btn:disabled { opacity:0.6; cursor:not-allowed; transform:none; }
    .btn.danger { background:linear-gradient(135deg,#dc3545,#c82333); width:auto; padding:8px 15px; font-size:0.9rem; }
    .transaction-item { 
        display:flex; justify-content:space-between; align-items:center; padding:20px; border:1px solid var(--border-color); 
        border-radius:12px; margin-bottom:15px; background:var(--bg-primary); transition: all 0.3s ease; flex-direction:column; align-items:flex-start;
    }
    .transaction-item:hover { background:var(--split-tag-bg); box-shadow:0 5px 15px var(--shadow-color); }
    .transaction-info { flex: 1; display: flex; justify-content: space-between; align-items: center; width: 100%; }
    .transaction-info h4 { margin-bottom:0; color:var(--text-color); font-size:1.1rem; }
    .transaction-details { font-size: 0.9rem; color: var(--text-secondary); display: flex; gap: 15px; }
    .filter-controls { display:flex; gap:15px; flex-wrap:wrap; margin-bottom:20px; align-items:flex-end; }
    .filter-controls .form-group { margin-bottom:0; flex-grow:1; min-width: 150px; }
    .filter-controls button { padding: 10px 20px; }
    .category-filter { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:25px; }
    .category-tag { padding:8px 16px; background:var(--split-tag-bg); border-radius:25px; font-size:0.9rem; cursor:pointer; transition: all 0.3s ease; border:2px solid transparent; color:var(--text-color); }
    .category-tag.active { background:#667eea; color:white; border-color:#5a6fd8; }
    .empty-state { text-align:center; padding:60px 20px; color:var(--text-secondary); }
    .transaction-amount { font-weight: bold; font-size: 1.2rem; }
    .expense-color { color: #ff6b6b; }
    .income-color { color: #40c057; }
    .split-color { color: #228be6; }
    .recurring-info { color:var(--recurring-color); font-size:0.9rem; font-weight:600; margin-top:3px; }
</style>
</head>
<body>
<div class="container">
    <div class="header scroll-reveal">
        <h1>ExpenseTracker</h1>
        <button class="btn" id="logoutBtn" style="position:absolute; right:20px; top:20px; padding:6px 12px; font-size:0.9rem;">Logout</button>
    </div>
    
    <div class="summary-cards scroll-reveal">
        <div class="summary-card"><h3>Total Expenses</h3><div class="amount" id="totalExpenses">‚Çπ0.00</div></div>
        <div class="summary-card income"><h3>Total Income</h3><div class="amount" id="totalIncome">‚Çπ0.00</div></div>
        <div class="summary-card balance"><h3>Balance</h3><div class="amount" id="balance">‚Çπ0.00</div></div>
        <div class="summary-card savings"><h3>This Month</h3><div class="amount" id="monthlySpent">‚Çπ0.00</div></div>
    </div>
    <div class="dashboard">
        <div class="card scroll-reveal">
            <h2>‚ûï Add New Transaction</h2>
            <form id="transactionForm">
                <div class="form-group">
                    <label for="type">Transaction Type</label>
                    <select id="type" required>
                        <option value="expense">üí∏ Expense</option>
                        <option value="income">üí∞ Income</option>
                        <option value="split">ü§ù Split</option>
                    </select>
                </div>
                <div class="form-group" id="splitwiseParticipantsDiv" style="display:none;">
                  <label>Split Participants</label>
                  <div style="display:flex; gap:10px; margin-bottom:8px;">
                    <input type="text" id="participantInput" placeholder="Enter name e.g. Alice" style="flex:1;">
                    <button type="button" class="btn" id="addParticipantBtn" style="width:auto;">Add</button>
                  </div>
                  <div id="participantsList" style="font-size:0.9rem; color:var(--text-secondary);">
                    <em>No participants added yet</em>
                  </div>
                </div>
                <div class="form-group">
                    <label for="amount">Amount (‚Çπ)</label>
                    <input type="number" id="amount" step="0.01" min="0.01" placeholder="0.00" required>
                </div>
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" required>
                        <option value="">Select Category</option>
                        <option value="food">üçï Food & Dining</option>
                        <option value="transport">üöó Transportation</option>
                        <option value="shopping">üõçÔ∏è Shopping</option>
                        <option value="entertainment">üé¨ Entertainment</option>
                        <option value="utilities">üí° Utilities</option>
                        <option value="healthcare">üè• Healthcare</option>
                        <option value="education">üìö Education</option>
                        <option value="salary">üíº Salary</option>
                        <option value="freelance">üíª Freelance</option>
                        <option value="other">üìã Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <input type="text" id="description" placeholder="e.g., Lunch at restaurant" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isRecurring"> Recurring (rent, subscription, etc)
                    </label>
                </div>
                <div class="form-group" id="recurringOptions" style="display: none;">
                    <label for="recurringFrequency">Frequency</label>
                    <select id="recurringFrequency">
                        <option value="monthly">Monthly</option>
                        <option value="weekly">Weekly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                    <label for="recurringEndDate" style="margin-top:8px">End Date</label>
                    <input type="date" id="recurringEndDate">
                </div>
                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" required>
                </div>
                <button type="submit" class="btn" id="submitBtn">Add Transaction</button>
            </form>
        </div>
        <div class="card scroll-reveal">
            <h2>üìä Category Breakdown</h2>
            <div id="categoryReport">
                <div class="empty-state" style="padding: 20px;">
                    <p>Add transactions to see a category breakdown.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="card scroll-reveal">
        <h2>üßæ Transaction History</h2>
        <div class="filter-controls">
            <div class="form-group">
                <label for="filterSearch">Search Description</label>
                <input type="text" id="filterSearch" placeholder="e.g., Dinner, Salary">
            </div>
            <div class="form-group">
                <label for="filterType">Type</label>
                <select id="filterType">
                    <option value="all">All</option>
                    <option value="expense">Expense</option>
                    <option value="income">Income</option>
                    <option value="split">Splitwise</option>
                </select>
            </div>
            <div class="form-group">
                <label for="filterSort">Sort By</label>
                <select id="filterSort">
                    <option value="date-desc">Date (Newest)</option>
                    <option value="date-asc">Date (Oldest)</option>
                    <option value="amount-desc">Amount (Highest)</option>
                    <option value="amount-asc">Amount (Lowest)</option>
                </select>
            </div>
            <button class="btn" id="applyFiltersBtn" style="min-width: 100px;">Apply</button>
        </div>
        <div id="transactionList">
            <div class="empty-state">
                <h3>No transactions recorded yet</h3>
                <p>Add your first income or expense above!</p>
            </div>
        </div>
    </div>
    <div class="card scroll-reveal" style="margin-top: 20px;">
        <h2>ü§ù Splitwise / Owing</h2>
        <div class="category-filter" id="splitwiseFilter">
            <div class="category-tag active" data-filter="all">All</div>
            <div class="category-tag" data-filter="paid">Paid</div>
            <div class="category-tag" data-filter="unpaid">Unpaid</div>
        </div>
        <div id="splitwiseList">
            <div class="empty-state">
                <h3>No splitwise transactions yet</h3>
                <p>Add a new splitwise transaction above!</p>
            </div>
        </div>
    </div>
</div>
<script>
// ----- User Data Management -----
function saveUserTransactions(email, transactions) {
    let all = JSON.parse(localStorage.getItem('expenseTrackerTransactions') || '{}');
    all[email] = transactions;
    localStorage.setItem('expenseTrackerTransactions', JSON.stringify(all));
}
function loadUserTransactions(email) {
    let all = JSON.parse(localStorage.getItem('expenseTrackerTransactions') || '{}');
    return all[email] || [];
}

// ----- GLOBAL STATE -----
let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
if(!loggedInUser) window.location.href = 'login.html';
let transactions = loadUserTransactions(loggedInUser.email);
let splitwiseTransactions = [];
let currentSplitwiseFilter = 'all';
let currentParticipants = [];

// Scroll reveal setup - improved with debugging logs and fallback
function setupScrollReveal() {
  const elements = document.querySelectorAll('.scroll-reveal');
  if (elements.length === 0) {
    console.log('No scroll-reveal elements found');
    return;
  }
  const options = {
    root: null,
    rootMargin: '0px 0px -150px 0px', // Trigger a bit early
    threshold: 0
  };
  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if(entry.isIntersecting) {
        entry.target.classList.add('visible');
        obs.unobserve(entry.target);
        console.log('Revealed: ', entry.target);
      }
    });
  }, options);
  elements.forEach(el => observer.observe(el));

  // Fallback for elements fully visible on load (no scroll)
  setTimeout(() => {
    elements.forEach(el => {
      if (!el.classList.contains('visible')) {
        el.classList.add('visible');
        console.log('Fallback reveal: ', el);
      }
    });
  }, 1000);
}

// -------------------- Recurring Transactions -------------------------
function checkRecurringTransactions() {
    const todayStr = new Date().toISOString().split('T')[0];
    transactions.forEach(txn => {
        if(txn.recurring){
            if(txn.recurring.nextDueDate <= todayStr && (!txn.recurring.endDate || txn.recurring.nextDueDate <= txn.recurring.endDate)){
                setTimeout(() => {
                    alert(`Reminder: Recurring transaction "${txn.description}" is due (${txn.recurring.nextDueDate})`);
                }, 500);
                if(!transactions.some(t => t.recurring && t.description==txn.description && t.date==todayStr)){
                    const nextTxn = Object.assign({}, txn);
                    nextTxn.id = Date.now();
                    nextTxn.date = todayStr;
                    nextTxn.recurring = Object.assign({}, txn.recurring);
                    nextTxn.recurring.nextDueDate = getNextRecurringDate(todayStr, txn.recurring.frequency);
                    transactions.push(nextTxn);
                    saveToLocalStorage();
                }
                txn.recurring.nextDueDate = getNextRecurringDate(todayStr, txn.recurring.frequency);
                saveToLocalStorage();
            }
        }
    });
}
function getNextRecurringDate(currentDate, frequency){
    const dateObj = new Date(currentDate);
    if(frequency==='monthly'){
        dateObj.setMonth(dateObj.getMonth()+1);
    } else if(frequency==='weekly'){
        dateObj.setDate(dateObj.getDate()+7);
    } else if(frequency==='yearly'){
        dateObj.setFullYear(dateObj.getFullYear()+1);
    }
    return dateObj.toISOString().split('T')[0];
}

// ---------------------- Core App Logic ---------------------
function saveToLocalStorage() {
    saveUserTransactions(loggedInUser.email, transactions);
}
function calculateSummary() {
    let totalIncome = 0;
    let totalExpenses = 0;
    const today = new Date();
    const currentMonth = today.getMonth();
    const currentYear = today.getFullYear();
    let monthlySpent = 0;
    transactions.forEach(t => {
        const txnDate = new Date(t.date);
        if (t.type === 'income') {
            totalIncome += t.amount;
        }
        if (t.type === 'expense') {
            totalExpenses += t.amount; 
        }
        if (t.type === 'split') {
            const myShare = t.amount / (t.owings.length + 1);
            totalExpenses += myShare;
            t.owings.forEach(owing => {
                if (!owing.paid) {
                    totalExpenses += owing.amount;
                }
            });
        }
        if (t.type !== 'income' && txnDate.getMonth() === currentMonth && txnDate.getFullYear() === currentYear) {
            if (t.type === 'expense') {
                monthlySpent += t.amount;
            } else if (t.type === 'split') {
                const myShare = t.amount / (t.owings.length + 1);
                monthlySpent += myShare;
                t.owings.forEach(owing => {
                    if (!owing.paid) {
                        monthlySpent += owing.amount;
                    }
                });
            }
        }
    });
    const balance = totalIncome - totalExpenses;
    document.getElementById('totalIncome').textContent = '‚Çπ' + totalIncome.toFixed(2);
    document.getElementById('totalExpenses').textContent = '‚Çπ' + totalExpenses.toFixed(2);
    document.getElementById('balance').textContent = '‚Çπ' + balance.toFixed(2);
    document.getElementById('monthlySpent').textContent = '‚Çπ' + monthlySpent.toFixed(2);
    generateCategoryReport(); 
}
document.addEventListener('DOMContentLoaded', () => {
    if(!loggedInUser) window.location.href = 'login.html';
    transactions = loadUserTransactions(loggedInUser.email);
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    setupEventListeners();
    checkRecurringTransactions();
    calculateSummary();
    displayTransactions(); 
    displaySplitwise();
    setupScrollReveal(); // Enable scroll reveal here
});
function setupEventListeners(){
    document.getElementById('transactionForm').addEventListener('submit', handleFormSubmit);
    document.getElementById('splitwiseFilter').addEventListener('click', handleSplitwiseFilter);
    document.getElementById('type').addEventListener('change', toggleSplitwiseFields);
    document.getElementById('addParticipantBtn').addEventListener('click', () => {
        const name = document.getElementById('participantInput').value.trim();
        if (name) {
            currentParticipants.push(name);
            document.getElementById('participantInput').value = '';
            renderParticipantsList();
        }
    });
    document.getElementById('applyFiltersBtn').addEventListener('click', () => displayTransactions());
    document.getElementById('isRecurring').addEventListener('change', function() {
        document.getElementById('recurringOptions').style.display = this.checked ? 'block' : 'none';
    });
}
function toggleSplitwiseFields(){
    const type = document.getElementById('type').value;
    document.getElementById('splitwiseParticipantsDiv').style.display = (type==='split')?'block':'none';
}
function renderParticipantsList() {
    const listDiv = document.getElementById('participantsList');
    if (currentParticipants.length === 0) {
        listDiv.innerHTML = '<em>No participants added yet</em>';
        return;
    }
    listDiv.innerHTML = currentParticipants.map((p,i)=>
        `<span style="display:inline-block;background:var(--split-tag-bg);padding:4px 10px;border-radius:12px;margin:3px;color:var(--text-color);">
           ${p} <button type="button" style="border:none;background:none;color:#dc3545;cursor:pointer;font-size:0.8rem;" onclick="removeParticipant(${i})">√ó</button>
         </span>`
    ).join('');
}
function removeParticipant(index){
    currentParticipants.splice(index,1);
    renderParticipantsList();
}
function handleSplitwiseFilter(e){
    if(e.target.classList.contains('category-tag')){
        document.querySelectorAll('#splitwiseFilter .category-tag').forEach(t=>t.classList.remove('active'));
        e.target.classList.add('active');
        currentSplitwiseFilter = e.target.dataset.filter;
        displaySplitwise();
    }
}
function handleFormSubmit(e){
    e.preventDefault();
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled=true;
    submitBtn.textContent='Adding...';
    const type = document.getElementById('type').value;
    const amount = parseFloat(document.getElementById('amount').value);
    const category = document.getElementById('category').value;
    const description = document.getElementById('description').value;
    const date = document.getElementById('date').value;
    // Recurring fields
    const isRecurring = document.getElementById('isRecurring').checked;
    let recurringData = null;
    if(isRecurring){
        const frequency = document.getElementById('recurringFrequency').value;
        const endDate = document.getElementById('recurringEndDate').value;
        const nextDueDate = date;
        recurringData = { frequency, endDate, nextDueDate };
    }
    const newTransaction = { 
        id:Date.now(), type, amount, category, description, date,
        recurring: isRecurring ? recurringData : null 
    };
    if(type==='split'){
        if (currentParticipants.length === 0) {
            alert('Please add at least one participant');
            submitBtn.disabled=false;
            submitBtn.textContent='Add Transaction';
            return;
        }
        const perPerson = amount / (currentParticipants.length + 1); 
        const participants = currentParticipants.map(name=>({name, amount:perPerson, paid:false}));
        newTransaction.owings = participants;
        currentParticipants = [];
        renderParticipantsList();
    }
    transactions.unshift(newTransaction);
    saveToLocalStorage();
    splitwiseTransactions = transactions.filter(t=>t.type==='split');
    displayTransactions();
    displaySplitwise();
    calculateSummary(); 
    document.getElementById('transactionForm').reset();
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    document.getElementById('recurringOptions').style.display='none';
    submitBtn.disabled=false;
    submitBtn.textContent='Add Transaction';
}
function togglePaid(transactionId, participantIndex){
    const txn = transactions.find(t => t.id === transactionId);
    if(txn && txn.owings && txn.owings[participantIndex] !== undefined){
        txn.owings[participantIndex].paid = !txn.owings[participantIndex].paid;
        saveToLocalStorage(); 
        displaySplitwise();
        calculateSummary();
    }
}
function displayTransactions() {
    const container = document.getElementById('transactionList');
    let filteredTransactions = [...transactions]; 
    const search = document.getElementById('filterSearch').value.toLowerCase();
    const typeFilter = document.getElementById('filterType').value;
    const sortBy = document.getElementById('filterSort').value;
    if (search) {
        filteredTransactions = filteredTransactions.filter(t => 
            t.description.toLowerCase().includes(search) || t.category.toLowerCase().includes(search)
        );
    }
    if (typeFilter !== 'all') {
        filteredTransactions = filteredTransactions.filter(t => t.type === typeFilter);
    }
    filteredTransactions.sort((a, b) => {
        switch (sortBy) {
            case 'date-asc':
                return new Date(a.date) - new Date(b.date);
            case 'amount-desc':
                return b.amount - a.amount;
            case 'amount-asc':
                return a.amount - b.amount;
            case 'date-desc':
            default:
                return new Date(b.date) - new Date(a.date);
        }
    });
    if (filteredTransactions.length === 0) {
        container.innerHTML = `<div class="empty-state">
            <h3>No matching transactions found</h3>
            <p>Try broadening your filter criteria.</p>
        </div>`;
        return;
    }
    container.innerHTML = filteredTransactions.map(t => {
        let typeText = '';
        let amountClass = '';
        let amountSign = '';
        switch (t.type) {
            case 'income':
                typeText = 'üí∞ Income';
                amountClass = 'income-color';
                amountSign = '+';
                break;
            case 'expense':
                typeText = 'üí∏ Expense';
                amountClass = 'expense-color';
                amountSign = '-';
                break;
            case 'split':
                typeText = 'ü§ù Splitwise';
                amountClass = 'split-color';
                amountSign = '-';
                break;
        }
        return `
            <div class="transaction-item">
                <div class="transaction-info">
                    <div>
                        <h4>${t.description}</h4>
                        <div class="transaction-details">
                            <span>${t.date}</span> |
                            <span>${typeText}</span> |
                            <span>${t.category.charAt(0).toUpperCase() + t.category.slice(1)}</span>
                        </div>
                        ${t.recurring ? `<div class="recurring-info">Recurring: ${t.recurring.frequency.charAt(0).toUpperCase() + t.recurring.frequency.slice(1)} (next: ${t.recurring.nextDueDate}${t.recurring.endDate ? ', end: ' + t.recurring.endDate : ''})</div>` : ''}
                    </div>
                    <div class="transaction-amount ${amountClass}">
                        ${amountSign}‚Çπ${t.amount.toFixed(2)}
                    </div>
                    <button class="btn danger" onclick="deleteTransaction(${t.id})" style="margin-left:10px; font-size:0.9rem;">Delete</button>
                </div>
            </div>
        `;
    }).join('');
}
function deleteTransaction(id) {
    transactions = transactions.filter(t => t.id !== id);
    saveToLocalStorage();
    displayTransactions();
    displaySplitwise();
    calculateSummary();
}
function generateCategoryReport() {
    const reportDiv = document.getElementById('categoryReport');
    const expensesByCategory = {};
    let totalExpenseAmount = 0;
    transactions.forEach(t => {
        let actualExpense = 0;
        if (t.type === 'expense') {
            actualExpense = t.amount;
        } else if (t.type === 'split') {
            const myShare = t.amount / (t.owings.length + 1);
            actualExpense += myShare;
            t.owings.forEach(owing => {
                if (!owing.paid) {
                    actualExpense += owing.amount;
                }
            });
        }
        if (actualExpense > 0) {
            const category = t.category.charAt(0).toUpperCase() + t.category.slice(1);
            expensesByCategory[category] = (expensesByCategory[category] || 0) + actualExpense;
            totalExpenseAmount += actualExpense;
        }
    });
    if (totalExpenseAmount === 0) {
        reportDiv.innerHTML = `<div class="empty-state" style="padding: 20px;">
            <p>Add expenses to see a category breakdown.</p>
        </div>`;
        return;
    }
    const reportData = Object.keys(expensesByCategory).map(category => ({
        category,
        amount: expensesByCategory[category],
        percentage: (expensesByCategory[category] / totalExpenseAmount) * 100
    })).sort((a, b) => b.amount - a.amount);
    reportDiv.innerHTML = `
        <div style="margin-bottom: 10px; font-weight: 600;">Total Expenses: ‚Çπ${totalExpenseAmount.toFixed(2)}</div>
        ${reportData.map(item => `
            <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; font-size: 0.95rem;">
                    <span>${item.category}</span>
                    <span>‚Çπ${item.amount.toFixed(2)} (${item.percentage.toFixed(1)}%)</span>
                </div>
                <div style="height: 8px; background: var(--border-color); border-radius: 4px; margin-top: 4px;">
                    <div style="width: ${item.percentage}%; height: 100%; background: #ff6b6b; border-radius: 4px;"></div>
                </div>
            </div>
        `).join('')}
    `;
}
function displaySplitwise(){
    const container = document.getElementById('splitwiseList');
    const currentSplitTxns = transactions.filter(t=>t.type==='split').sort((a,b) => b.id - a.id);
    if(currentSplitTxns.length===0){
        container.innerHTML = `<div class="empty-state">
          <h3>No splitwise transactions yet</h3>
          <p>Add a new splitwise transaction above!</p>
        </div>`;
        return;
    }
    container.innerHTML = currentSplitTxns.map(t=>{
        const visibleOwings = t.owings.map((o, idx)=>{ 
                const hide = (currentSplitwiseFilter === 'paid' && !o.paid) || (currentSplitwiseFilter === 'unpaid' && o.paid);
                if (hide) return '';
                return `
                  <p style="margin-top:10px;">
                    ${o.name} owes ‚Çπ${o.amount.toFixed(2)}
                    ${o.paid ? '<span style="color:green; font-weight:600;">(Paid)</span>' : '<span style="color:#dc3545; font-weight:600;">(Unpaid)</span>'}
                    <button class="btn ${o.paid ? '' : 'danger'}" 
                            style="margin-left:10px; padding:6px 12px; font-size:0.8rem;" 
                            onclick="togglePaid(${t.id}, ${idx})">
                      Mark ${o.paid ? 'Unpaid' : 'Paid'}
                    </button>
                  </p>
                `;
              }).join('');
        if (!visibleOwings) return '';
        return `
          <div class="transaction-item">
            <div class="transaction-info" style="display: block;">
              <h4>${t.description} (Total: ‚Çπ${t.amount.toFixed(2)})</h4>
              <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">Your Share: ‚Çπ${(t.amount / (t.owings.length + 1)).toFixed(2)}</div>
              ${visibleOwings}
              ${t.recurring ? `<div class="recurring-info">Recurring: ${t.recurring.frequency.charAt(0).toUpperCase()+t.recurring.frequency.slice(1)} (next: ${t.recurring.nextDueDate}${t.recurring.endDate ? ', end: ' + t.recurring.endDate : ''})</div>` : ''}
            </div>
          </div>
        `;
    }).join('');
}

// ----- LOGOUT BUTTON -----
document.getElementById('logoutBtn').addEventListener('click', () => {
    const confirmLogout = confirm("Are you sure you want to logout? All local session data will be cleared.");
    if(confirmLogout){
        saveToLocalStorage();
        localStorage.removeItem('loggedInUser');
        alert('You have been logged out successfully.');
        window.location.href = 'login.html';
    }
});
</script>
</body>
</html>
